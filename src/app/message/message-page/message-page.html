<div class="page-container">
  <app-navbar (toggleSidebar)="onToggleSidebar()"></app-navbar>

  <div class="content-wrapper">
    <app-sidebar></app-sidebar>

    <main class="main-content" [class.sidebar-collapsed]="isSidebarCollapsed()">
      <div class="messages-layout">
        <!-- Channel Sidebar Component -->
        <app-channel-list
          [teams]="teams()"
          [selectedTeamId]="selectedTeamId()"
          [selectedChannelId]="selectedChannelId()"
          [showTeamDropdown]="showTeamDropdown()"
          (teamSelected)="selectTeam($event)"
          (channelSelected)="selectChannel($event)"
          (toggleDropdown)="toggleTeamDropdown()"
          (closeDropdown)="closeTeamDropdown()"
          (addChannel)="addChannel($event)"
        ></app-channel-list>

        <!-- Main Chat Area -->
        <div class="chat-area">
          <!-- Chat Header -->
          <header class="chat-header">
            <div class="channel-info">
              <span class="channel-hash-large">#</span>
              <h2 class="channel-title">{{ selectedChannel()?.name }}</h2>
            </div>
            <div class="header-actions">
              <button
                class="header-btn"
                [class.active]="showSearch()"
                title="Search"
                (click)="toggleSearch()"
              >
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <circle cx="8" cy="8" r="5" stroke="currentColor" stroke-width="1.5" />
                  <path
                    d="M12 12L16 16"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
              <button class="header-btn" title="Members">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <circle cx="9" cy="5" r="3" stroke="currentColor" stroke-width="1.5" />
                  <path
                    d="M3 16v-2c0-2.2 1.8-4 4-4h4c2.2 0 4 1.8 4 4v2"
                    stroke="currentColor"
                    stroke-width="1.5"
                  />
                </svg>
              </button>
              <div style="position: relative">
                <button
                  class="header-btn"
                  [class.active]="showMoreMenu()"
                  title="More"
                  (click)="toggleMoreMenu()"
                >
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <circle cx="9" cy="3" r="1.5" fill="currentColor" />
                    <circle cx="9" cy="9" r="1.5" fill="currentColor" />
                    <circle cx="9" cy="15" r="1.5" fill="currentColor" />
                  </svg>
                </button>

                <!-- More Menu Dropdown -->
                @if (showMoreMenu()) {
                <div class="more-menu-overlay" (click)="closeMoreMenu()"></div>
                <div class="more-menu-dropdown">
                  <button class="more-menu-item delete-item" (click)="deleteChannel()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path
                        d="M2 4h12M5.333 4V2.667a1.333 1.333 0 0 1 1.334-1.334h2.666a1.333 1.333 0 0 1 1.334 1.334V4m2 0v9.333a1.333 1.333 0 0 1-1.334 1.334H4.667a1.333 1.333 0 0 1-1.334-1.334V4h9.334Z"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    <span>Delete Channel</span>
                  </button>
                </div>
                }
              </div>
            </div>
          </header>

          <!-- Search Bar (appears when search is active) -->
          @if (showSearch()) {
          <div class="search-bar">
            <div class="search-input-wrapper">
              <svg class="search-icon" width="16" height="16" viewBox="0 0 18 18" fill="none">
                <circle cx="8" cy="8" r="5" stroke="currentColor" stroke-width="1.5" />
                <path
                  d="M12 12L16 16"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                />
              </svg>
              <input
                type="text"
                class="search-input"
                placeholder="Search messages in #{{ selectedChannel()?.name }}..."
                [value]="searchQuery()"
                (input)="onSearchQueryChange($any($event.target).value)"
                autofocus
              />
              @if (searchQuery()) {
              <button class="clear-search-btn" (click)="clearSearch()" title="Clear search">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path
                    d="M2 2L12 12M12 2L2 12"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
              }
            </div>
            @if (searchQuery()) {
            <div class="search-results-info">
              {{ messages().length }} {{ messages().length === 1 ? 'result' : 'results' }} found
            </div>
            }
          </div>
          }

          <!-- Message List Component -->
          <app-message-list
            [messages]="messages()"
            [channelName]="selectedChannel()?.name || ''"
            [searchQuery]="searchQuery()"
          ></app-message-list>

          <!-- Message Input Component -->
          <app-message-input
            [channelName]="selectedChannel()?.name || ''"
            (messageSent)="onMessageSent($event)"
          ></app-message-input>
        </div>
      </div>
    </main>
  </div>
</div>
