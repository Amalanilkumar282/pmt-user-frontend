<div class="all-issues-card">
  <div class="all-issues-header">
    <div class="header-left" (click)="toggleCollapse()">
      <span class="collapse-icon">{{ isCollapsed() ? '▶' : '▼' }}</span>
      <div>
        <h3 class="all-issues-title">All Issues <span class="issue-count-inline">({{ issues.length }})</span></h3>
        <p class="all-issues-subtitle">View all issues including completed ones</p>
      </div>
    </div>
  </div>
  
  <!-- Collapsible Content -->
  <div class="collapsible-content" [class.collapsed]="isCollapsed()">
    <!-- Active Issues Section -->
    @if (activeIssues().length > 0) {
      <div class="issues-group">
        <h4 class="issues-group-title">Active Issues ({{ activeIssues().length }})</h4>
        <div class="issues-section">
          @for (issue of activeIssues(); track issue.id) {
            <div 
              class="bg-white border border-gray-200 rounded-md p-2.5 hover:shadow-md transition-shadow cursor-pointer hover:bg-gray-50"
              (click)="onIssueClick(issue)">
              
              <div class="flex items-center justify-between gap-3">
                <!-- Left side: Icon, ID, Title -->
                <div class="flex items-center gap-2 flex-1 min-w-0">
                  <span class="text-base flex-shrink-0">{{ getTypeIcon(issue.type) }}</span>
                  <span class="text-xs font-semibold text-gray-500 flex-shrink-0">{{ issue.id }}</span>
                  <h4 class="font-medium text-gray-900 text-sm truncate">
                    {{ issue.title }}
                  </h4>
                </div>
                
                <!-- Right side: Metadata -->
                <div class="flex items-center gap-2 flex-shrink-0">
                  <span [class]="'px-2 py-0.5 rounded text-xs font-medium ' + getPriorityClass(issue.priority)">
                    {{ issue.priority }}
                  </span>
                  
                  @if (issue.storyPoints) {
                    <span class="text-xs text-gray-600 font-semibold bg-gray-100 px-2 py-0.5 rounded">
                      {{ issue.storyPoints }} SP
                    </span>
                  }
                  
                  @if (issue.assignee) {
                    <span class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-semibold flex-shrink-0">
                      {{ issue.assignee.charAt(0).toUpperCase() }}
                    </span>
                  }
                  
                  <span class="px-2 py-0.5 bg-gray-100 rounded text-xs font-medium text-gray-600">
                    {{ issue.status.replace('_', ' ') }}
                  </span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Completed Issues Section -->
    @if (completedIssues().length > 0) {
      <div class="issues-group completed-group">
        <h4 class="issues-group-title">
          <span class="completed-badge">✓</span> Completed Issues ({{ completedIssues().length }})
        </h4>
        <div class="issues-section">
          @for (issue of completedIssues(); track issue.id) {
            <div 
              class="completed-issue-card bg-green-50 border border-green-200 rounded-md p-2.5 hover:shadow-md transition-shadow cursor-pointer hover:bg-green-100"
              (click)="onIssueClick(issue)">
              
              <div class="flex items-center justify-between gap-3">
                <!-- Left side: Icon, ID, Title -->
                <div class="flex items-center gap-2 flex-1 min-w-0">
                  <span class="text-base flex-shrink-0">{{ getTypeIcon(issue.type) }}</span>
                  <span class="text-xs font-semibold text-green-700 flex-shrink-0">{{ issue.id }}</span>
                  <h4 class="font-medium text-green-800 text-sm truncate">
                    {{ issue.title }}
                  </h4>
                </div>
                
                <!-- Right side: Metadata -->
                <div class="flex items-center gap-2 flex-shrink-0">
                  <span [class]="'px-2 py-0.5 rounded text-xs font-medium ' + getPriorityClass(issue.priority)">
                    {{ issue.priority }}
                  </span>
                  
                  @if (issue.storyPoints) {
                    <span class="text-xs text-green-700 font-semibold bg-green-100 px-2 py-0.5 rounded">
                      {{ issue.storyPoints }} SP
                    </span>
                  }
                  
                  @if (issue.assignee) {
                    <span class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-xs font-semibold flex-shrink-0">
                      {{ issue.assignee.charAt(0).toUpperCase() }}
                    </span>
                  }
                  
                  <span class="px-2 py-0.5 bg-green-100 rounded text-xs font-medium text-green-700">
                    <span class="completed-checkmark">✓</span> DONE
                  </span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }

    @if (issues.length === 0) {
      <div class="text-center py-8 text-gray-500">
        <p class="text-lg">No issues yet</p>
        <p class="text-sm">Add issues to get started</p>
      </div>
    }

    <!-- Pagination Controls -->
    @if (issues.length > 0) {
      <div class="pagination-controls">
        <div class="pagination-info">
          <div class="items-per-page">
            <label for="itemsPerPage">Items per page:</label>
            <select 
              id="itemsPerPage"
              [(ngModel)]="itemsPerPage"
              (change)="onItemsPerPageChange()">
              <option [value]="5">5</option>
              <option [value]="10">10</option>
              <option [value]="15">15</option>
              <option [value]="20">20</option>
              <option [value]="25">25</option>
              <option [value]="50">50</option>
            </select>
          </div>
          <div class="page-info">
            Showing <strong>{{ startItem }}</strong> - <strong>{{ endItem }}</strong> of <strong>{{ issues.length }}</strong> issues
          </div>
        </div>

        <div class="pagination-buttons">
          <button 
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="goToFirstPage()">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11 5l-7 7 7 7M18 5l-7 7 7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            First
          </button>
          
          <button 
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="previousPage()">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 5l-7 7 7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Previous
          </button>

          <span class="page-number">Page {{ currentPage }} of {{ totalPages }}</span>

          <button 
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()">
            Next
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <button 
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="goToLastPage()">
            Last
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 5l7 7-7 7M6 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    }
  </div>
</div>

<!-- Issue Detailed View Modal -->
<app-issue-detailed-view
  [issue]="selectedIssue()"
  [isOpen]="isModalOpen()"
  [availableSprints]="availableSprints"
  (close)="onCloseModal()"
  (deleteIssue)="onDeleteIssue($event)"
  (moveIssue)="onMoveIssue($event)">
</app-issue-detailed-view>
