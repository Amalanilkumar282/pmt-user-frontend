<div class="relative inline-block">
	<button class="flex items-center gap-1.5 px-3 py-2 rounded-lg text-[#3D62A8] text-sm font-medium hover:bg-[#3D62A8] hover:text-white hover:cursor-pointer focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 transition-colors" (click)="open()">
		<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
			<path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
		</svg>
	</button>

	<!-- Full Screen Modal -->
	<div *ngIf="isOpen" class="fixed inset-0 z-[9999] flex items-center justify-center">
		<!-- Dark Backdrop -->
		<div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="close()"></div>
		
		<!-- Modal Content -->
		<div class="relative w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto rounded-2xl bg-white shadow-2xl">
			<!-- Header -->
			<div class="sticky top-0 z-10 bg-white border-b border-slate-200 px-6 py-5 flex items-center justify-between">
				<div>
					<h3 class="text-xl font-bold text-slate-900">Create New Column</h3>
					<p class="text-sm text-slate-500 mt-1">Add a column to organize your tasks</p>
				</div>
				<button (click)="close()" class="text-slate-400 hover:text-slate-700 transition-colors p-2 rounded-lg hover:bg-slate-100 cursor-pointer">
					<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
					</svg>
				</button>
			</div>

			<!-- Content -->
			<div class="px-6 py-6 space-y-6">
				<!-- Column Name -->
				<div>
					<label class="block text-sm font-semibold text-slate-700 mb-2">
						Column Name <span class="text-red-500">*</span>
					</label>
					<input 
						[(ngModel)]="name" 
						class="w-full rounded-lg border-2 border-slate-200 px-4 py-3 text-sm focus:outline-none focus:border-[#3D62A8] focus:ring-2 focus:ring-[#3D62A8]/20 transition-all" 
						placeholder="e.g., Code Review, Testing, Ready for Deploy" 
						maxlength="50"
						autofocus />
					<div class="mt-2 flex items-center justify-between">
						<span class="text-xs text-slate-500">Use a clear, descriptive name</span>
						<span class="text-xs font-medium" [class.text-slate-500]="name.length < 40" [class.text-amber-600]="name.length >= 40">
							{{ name.length }}/50
						</span>
					</div>
				</div>

				<!-- Position and Status in same row -->
				<div class="grid grid-cols-2 gap-4">
					<!-- Position -->
					<div>
						<label class="block text-sm font-semibold text-slate-700 mb-2">
							Position <span class="text-red-500">*</span>
						</label>
						<input 
							type="number" 
							[(ngModel)]="position" 
							min="1" 
							[max]="maxPosition()"
							class="w-full rounded-lg border-2 border-slate-200 px-4 py-3 text-sm focus:outline-none focus:border-[#3D62A8] focus:ring-2 focus:ring-[#3D62A8]/20 transition-all" 
							placeholder="Enter position" />
						<div class="mt-2">
							<span class="text-xs text-slate-500">Shifts columns right</span>
						</div>
					</div>

					<!-- Status Dropdown -->
					<div class="relative">
						<label class="block text-sm font-semibold text-slate-700 mb-2">
							Status (Optional)
						</label>
						<input 
							type="text"
							[(ngModel)]="statusSearchQuery"
							(input)="onStatusSearch($event)"
							(focus)="onStatusInputFocus()"
							(blur)="onStatusInputBlur()"
							class="w-full rounded-lg border-2 border-slate-200 px-4 py-3 text-sm focus:outline-none focus:border-[#3D62A8] focus:ring-2 focus:ring-[#3D62A8]/20 transition-all"
							placeholder="Search or create status" />
						
						<!-- Dropdown List -->
						<div *ngIf="showStatusDropdown" 
						     class="absolute z-10 w-full mt-1 bg-white border-2 border-slate-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"
						     appClickOutside
						     (outsideClick)="closeStatusDropdown()">
							<!-- Existing statuses -->
							<div 
								*ngFor="let status of filteredStatuses"
									(click)="selectStatus(status)"
									class="px-4 py-2.5 hover:bg-[#3D62A8] hover:text-white cursor-pointer transition-colors text-sm flex items-center justify-between">
									<span>{{ status.label }}</span>
									<span *ngIf="status.isExisting" class="text-xs font-medium text-green-600 hover:text-white">Existing</span>
							</div>
							
							<!-- No results message -->
							<div *ngIf="filteredStatuses.length === 0 && !isNewStatus" class="px-4 py-2.5 text-sm text-slate-500 italic">
								No matching statuses
							</div>
							
							<!-- Create new status option -->
							<div 
								*ngIf="isNewStatus"
								(click)="useNewStatus()"
								class="px-4 py-2.5 border-t-2 border-slate-200 hover:bg-green-50 cursor-pointer transition-colors">
								<div class="flex items-center gap-2">
									<svg class="w-4 h-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
										<path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
									</svg>
									<div>
										<div class="text-sm font-semibold text-green-600">Create new status</div>
										<div class="text-xs text-slate-500 font-mono">{{ statusSearchQuery }}</div>
									</div>
								</div>
							</div>
						</div>
						
						<div class="mt-2">
							<span class="text-xs text-slate-500">
								<span *ngIf="!isNewStatus">Search existing or type new</span>
								<span *ngIf="isNewStatus" class="text-green-600 font-semibold">âš¡ New status will be created</span>
							</span>
						</div>
					</div>
				</div>

				<!-- Color Selection -->
				<div>
					<label class="block text-sm font-semibold text-slate-700 mb-3">Column Color</label>
					
					<!-- Quick Color Options -->
					<div class="mb-4">
						<p class="text-xs text-slate-500 mb-2.5">Quick select</p>
						<div class="grid grid-cols-6 gap-2.5">
							<button 
								type="button" 
								*ngFor="let colorOpt of presetColors"
								(click)="color=colorOpt" 
								class="group relative h-11 rounded-lg transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3D62A8]"
								[style.background-color]="colorOpt"
								[class.ring-2]="color === colorOpt"
								[class.ring-[#3D62A8]]="color === colorOpt"
								[class.ring-offset-2]="color === colorOpt"
								[title]="getColorName(colorOpt)">
								<!-- Checkmark for selected -->
								<svg *ngIf="color === colorOpt" 
									class="absolute inset-0 m-auto w-5 h-5 text-white drop-shadow-lg" 
									fill="currentColor" 
									viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
								</svg>
							</button>
						</div>
					</div>

					<!-- Custom Color Picker -->
					<div class="border-t border-slate-200 pt-4">
						<p class="text-xs text-slate-500 mb-2.5">Custom color</p>
						<div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200">
							<div class="relative flex-shrink-0">
								<input 
									type="color" 
									[(ngModel)]="color"
									class="w-11 h-11 rounded-lg cursor-pointer border-2 border-slate-300 hover:border-[#3D62A8] transition-colors"
									title="Pick custom color" />
							</div>
							<div class="flex-1">
								<label class="block text-xs font-medium text-slate-600 mb-1.5">Hex Code</label>
								<input 
									type="text" 
									[(ngModel)]="color"
									(input)="validateHexColor($event)"
									class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm font-mono uppercase focus:outline-none focus:border-[#3D62A8] focus:ring-2 focus:ring-[#3D62A8]/20" 
									placeholder="#3D62A8"
									maxlength="7" />
							</div>
						</div>
					</div>
				</div>

				<!-- Preview Section -->
				<div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-4 border border-slate-200">
					<div class="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-3">Preview</div>
					<div class="bg-white rounded-lg p-3.5 shadow-sm border-l-4" [style.border-left-color]="color">
						<div class="flex items-center justify-between mb-2">
							<h4 class="text-sm font-bold uppercase tracking-wide text-[#3D62A8]">
								{{ name || 'Column Name' }}
							</h4>
							<span class="text-xs font-bold text-white rounded-full min-w-[26px] h-6 px-2 flex items-center justify-center shadow-sm" 
								[style.background-color]="color">
								3
							</span>
						</div>
						<div class="text-xs text-slate-500">Tasks will appear here</div>
					</div>
				</div>
			</div>

			<!-- Footer Actions -->
			<div class="sticky bottom-0 bg-slate-50 border-t border-slate-200 px-6 py-4 flex items-center justify-end gap-3">
				<button 
					class="px-5 py-2.5 rounded-lg border-2 border-slate-200 bg-white text-slate-700 text-sm font-semibold hover:bg-slate-50 hover:border-slate-300 transition-all focus:outline-none focus:ring-2 focus:ring-slate-200 cursor-pointer" 
					(click)="close()">
					Cancel
				</button>
				<button 
					[disabled]="!isValid() || isLoading"
					(click)="addColumn()" 
					class="px-5 py-2.5 rounded-lg bg-[#3D62A8] text-white text-sm font-semibold hover:bg-[#2F4D8C] disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[#3D62A8] transition-all shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#3D62A8]/50 flex items-center gap-2 cursor-pointer">
					<ng-container *ngIf="!isLoading; else loadingTpl">
						<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
							<path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
						</svg>
						<span>Create Column</span>
					</ng-container>
					<ng-template #loadingTpl>
						<svg class="animate-spin w-4 h-4" viewBox="0 0 24 24">
							<circle class="opacity-25" cx="12" cy="12" r="10" stroke="white" stroke-width="4" fill="none"></circle>
							<path class="opacity-75" fill="white" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
						</svg>
						<span>Creating...</span>
					</ng-template>
				</button>
			</div>
			<!-- Error message -->
			<div *ngIf="error" class="px-6 pb-4 text-sm text-red-600">{{ error }}</div>
		</div>
	</div>
</div>
