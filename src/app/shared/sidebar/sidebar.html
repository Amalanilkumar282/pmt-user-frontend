@if (isStateReady()) {
<!-- Mobile Overlay -->
<div *ngIf="!isCollapsed()" class="sidebar-overlay mobile-only" (click)="setCollapsed(true)"></div>

<aside class="sidebar" [class.collapsed]="isCollapsed()">
  <!-- Logo and Header -->
  <div class="sidebar-header">
    <div class="logo-container">
      <div class="logo-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M13 2L3 14h8l-1 8 10-12h-8l1-8z"
            fill="white"
            stroke="white"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
      <div class="logo-text" *ngIf="!isCollapsed()">
        <div class="logo-title">ProjectFlow</div>
        <div class="logo-subtitle">Team Workspace</div>
      </div>
    </div>
    <!-- Desktop Toggle Button -->
    <button class="toggle-btn desktop-only" (click)="toggleCollapse()" aria-label="Toggle sidebar">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          *ngIf="isCollapsed()"
          d="M9 18l6-6-6-6"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          *ngIf="!isCollapsed()"
          d="M15 18l-6-6 6-6"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>
  </div>

  <!-- Navigation Menu -->
  <nav class="sidebar-nav">
    <!-- Show project navigation if we're in a project context -->
    @if (currentProjectId()) {

      <a [routerLink]="['/projects', currentProjectId(), 'teams']" routerLinkActive="active" class="nav-item" [title]="isCollapsed() ? 'Teams' : ''">
        <svg
          class="nav-icon"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span *ngIf="!isCollapsed()">Teams</span>
      </a>
      
      <div class="nav-divider"></div>
    }

    <!-- General navigation -->
    <a
      [routerLink]="['/teams']"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: false }"
      class="nav-item"
      [title]="isCollapsed() ? 'Teams' : ''"
    >
      <svg
        class="nav-icon"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" />
        <path
          d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <span *ngIf="!isCollapsed()">All Teams</span>
    </a>

    <a
      [routerLink]="['/projects']"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: true }"
      class="nav-item"
      [title]="isCollapsed() ? 'Projects' : ''"
    >
      <svg
        class="nav-icon"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <rect
          x="2"
          y="4"
          width="20"
          height="16"
          rx="2"
          stroke="currentColor"
          stroke-width="2"
          fill="none"
        />
        <path d="M3 7h18M3 12h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg>
      <span *ngIf="!isCollapsed()">All Projects</span>
    </a>

    <a
      [routerLink]="['/dashboard']"
      routerLinkActive="active"
      class="nav-item"
      [title]="isCollapsed() ? 'Dashboard' : ''"
    >
      <svg
        class="nav-icon"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
      </svg>
      <span *ngIf="!isCollapsed()">Dashboard</span>
    </a>
  </nav>

  <!-- Recent Projects Section -->
  <div *ngIf="!isCollapsed()" class="recent-projects">
    <div class="section-title">Recent Projects</div>
    <div class="project-list">
      <div *ngFor="let project of recentProjects()" class="project-wrapper">
        <!-- Project Header -->
        <div class="project-item" (click)="navigateToProject(project.id)">
          <div class="project-info">
            <svg
              class="expand-icon"
              [class.expanded]="isProjectExpanded(project.id)"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              (click)="toggleProjectExpanded(project.id); $event.stopPropagation()"
            >
              <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="project-dot"></span>
            <span class="project-name">{{ project.name }}</span>
          </div>
        </div>

        <!-- Boards Dropdown -->
        <div *ngIf="isProjectExpanded(project.id)" class="boards-dropdown">
          <!-- Add Board Button -->
          <button
            type="button"
            class="board-item add-board-item"
            (click)="openAddBoardModal(project.id); $event.stopPropagation()"
          >
            <svg class="board-icon add-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="board-name">Add Board</span>
          </button>

          <!-- Boards List -->
          <div class="boards-list">
            <a 
              *ngFor="let board of project.boards" 
              [routerLink]="['/projects', project.id, 'board']"
              [queryParams]="{boardId: board.id}"
              class="board-item"
              [class.active]="boardService.currentBoardId() === board.id"
              (click)="navigateToBoard(project.id, board.id); $event.stopPropagation()"
            >
              <svg class="board-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="3" width="7" height="16" rx="1" stroke="currentColor" stroke-width="2"/>
                <rect x="14" y="3" width="7" height="10" rx="1" stroke="currentColor" stroke-width="2"/>
              </svg>
              <div class="board-info">
                <span class="board-name" [title]="board.name">
                  {{ board.type === 'TEAM' && board.teamName ? board.teamName : board.name }}
                </span>
                <span class="board-type-badge" [class.team-badge]="board.type === 'TEAM'" [class.project-badge]="board.type === 'PROJECT'">
                  {{ board.type === 'TEAM' ? 'Team' : 'Project' }}
                </span>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</aside>
}

<!-- Add Board Modal -->
<app-add-board-modal 
  #addBoardModal
  (boardCreated)="onBoardCreated($event)"
></app-add-board-modal>
