<div class="filters-container" [class.collapsed]="isCollapsed()">
  <!-- Header with Toggle Button -->
  <div class="filters-header">
    <div class="filters-title">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 7h18M10 12h11M3 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Filters</span>
      @if (hasActiveFilters() && !isCollapsed()) {
        <span class="active-count">({{ getActiveFilterCount() }} active)</span>
      }
    </div>
    <button class="collapse-toggle" (click)="toggleCollapse()" [attr.aria-label]="isCollapsed() ? 'Expand filters' : 'Collapse filters'">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        @if (isCollapsed()) {
          <path d="M19 9l-7 7-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        } @else {
          <path d="M5 15l7-7 7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        }
      </svg>
    </button>
  </div>

  <!-- Collapsible Content -->
  <div class="filters-content" [class.collapsed]="isCollapsed()">
    <!-- View Toggle -->
    <div class="view-toggle-container">
      <div class="view-toggle-buttons">
        <button 
          class="view-toggle-btn"
          [class.active]="currentView === 'sprints'"
          (click)="toggleView('sprints')">
          üìã Sprints
        </button>
        <button 
          class="view-toggle-btn"
          [class.active]="currentView === 'all-issues'"
          (click)="toggleView('all-issues')">
          üìù All Issues
        </button>
      </div>
    </div>

    <!-- Epic and Sprint Controls -->
    <div class="filter-controls">
      <!-- Epic Panel Toggle -->
      <label class="toggle-control">
        <input 
          type="checkbox" 
          class="toggle-input"
          [checked]="showEpicPanel()"
          (change)="toggleEpicPanel()">
        <span class="toggle-slider"></span>
        <span class="toggle-label">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
            <rect width="16" height="16" rx="2" fill="#8B5CF6"/>
            <rect x="3" y="3" width="10" height="10" rx="1" fill="white"/>
          </svg>
          Epic Panel
        </span>
      </label>

      <!-- Epic Filter Dropdown -->
      <div class="filter-dropdown compact">
        <button class="dropdown-toggle compact" (click)="toggleDropdown('epic')">
          <span class="dropdown-label">Epic:</span>
          <span class="dropdown-value">{{ getSelectedEpicName() }}</span>
          <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        @if (openDropdown === 'epic') {
          <div class="dropdown-menu">
            <div class="dropdown-item" (click)="onEpicFilterChange(null)">All Epics</div>
            @for (epic of epicOptions; track epic.id) {
              <div class="dropdown-item" (click)="onEpicFilterChange(epic.id)">{{ epic.name }}</div>
            }
          </div>
        }
      </div>

      <!-- Show Completed Sprints Toggle (only in sprints view) -->
      @if (currentView === 'sprints') {
        <label class="toggle-control">
          <input 
            type="checkbox" 
            class="toggle-input"
            [checked]="showCompletedSprints()"
            (change)="toggleCompletedSprints()">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Show Completed Sprints</span>
        </label>
      }
    </div>

    <!-- Search Bar -->
    <div class="search-box">
    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
      <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input 
      type="text" 
      class="search-input" 
      placeholder="Search issues..."
      [(ngModel)]="searchText"
      (input)="onSearchChange()">
    @if (searchText) {
      <button class="clear-search" (click)="clearSearch()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    }
  </div>

  <!-- Quick Filters -->
  <div class="quick-filters">
    <button 
      class="filter-chip"
      [class.active]="activeQuickFilter === 'assigned-to-me'"
      (click)="toggleQuickFilter('assigned-to-me')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Assigned to me</span>
    </button>

    <button 
      class="filter-chip"
      [class.active]="activeQuickFilter === 'recent'"
      (click)="toggleQuickFilter('recent')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Recent changes</span>
    </button>

    <button 
      class="filter-chip"
      [class.active]="activeQuickFilter === 'my-open'"
      (click)="toggleQuickFilter('my-open')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
      </svg>
      <span>My open issues</span>
    </button>

    <button 
      class="filter-chip"
      [class.active]="activeQuickFilter === 'unassigned'"
      (click)="toggleQuickFilter('unassigned')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="4" y1="20" x2="20" y2="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Unassigned</span>
    </button>
  </div>

  <!-- Advanced Filters -->
  <div class="advanced-filters">
    <!-- Type Filter -->
    <div class="filter-dropdown">
      <button class="dropdown-toggle" (click)="toggleDropdown('type')">
        <span class="dropdown-label">Type:</span>
        <span class="dropdown-value">{{ selectedType || 'All' }}</span>
        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      @if (openDropdown === 'type') {
        <div class="dropdown-menu">
          <div class="dropdown-item" (click)="selectType(null)">All Types</div>
          <div class="dropdown-item" (click)="selectType('STORY')">Story</div>
          <div class="dropdown-item" (click)="selectType('TASK')">Task</div>
          <div class="dropdown-item" (click)="selectType('BUG')">Bug</div>
          <div class="dropdown-item" (click)="selectType('EPIC')">Epic</div>
        </div>
      }
    </div>

    <!-- Priority Filter -->
    <div class="filter-dropdown">
      <button class="dropdown-toggle" (click)="toggleDropdown('priority')">
        <span class="dropdown-label">Priority:</span>
        <span class="dropdown-value">{{ selectedPriority || 'All' }}</span>
        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      @if (openDropdown === 'priority') {
        <div class="dropdown-menu">
          <div class="dropdown-item" (click)="selectPriority(null)">All Priorities</div>
          <div class="dropdown-item" (click)="selectPriority('CRITICAL')">Critical</div>
          <div class="dropdown-item" (click)="selectPriority('HIGH')">High</div>
          <div class="dropdown-item" (click)="selectPriority('MEDIUM')">Medium</div>
          <div class="dropdown-item" (click)="selectPriority('LOW')">Low</div>
        </div>
      }
    </div>

    <!-- Status Filter -->
    <div class="filter-dropdown">
      <button class="dropdown-toggle" (click)="toggleDropdown('status')">
        <span class="dropdown-label">Status:</span>
        <span class="dropdown-value">{{ selectedStatus || 'All' }}</span>
        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      @if (openDropdown === 'status') {
        <div class="dropdown-menu">
          <div class="dropdown-item" (click)="selectStatus(null)">All Statuses</div>
          <div class="dropdown-item" (click)="selectStatus('TODO')">To Do</div>
          <div class="dropdown-item" (click)="selectStatus('IN_PROGRESS')">In Progress</div>
          <div class="dropdown-item" (click)="selectStatus('IN_REVIEW')">In Review</div>
          <div class="dropdown-item" (click)="selectStatus('DONE')">Done</div>
        </div>
      }
    </div>

    <!-- Assignee Filter -->
    <div class="filter-dropdown">
      <button class="dropdown-toggle" (click)="toggleDropdown('assignee')">
        <span class="dropdown-label">Assignee:</span>
        <span class="dropdown-value">{{ selectedAssignee || 'All' }}</span>
        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      @if (openDropdown === 'assignee') {
        <div class="dropdown-menu">
          <div class="dropdown-item" (click)="selectAssignee(null)">All Assignees</div>
          <div class="dropdown-item" (click)="selectAssignee('John Doe')">John Doe</div>
          <div class="dropdown-item" (click)="selectAssignee('Jane Smith')">Jane Smith</div>
          <div class="dropdown-item" (click)="selectAssignee('Alex Johnson')">Alex Johnson</div>
          <div class="dropdown-item" (click)="selectAssignee('Sarah Lee')">Sarah Lee</div>
          <div class="dropdown-item" (click)="selectAssignee('Mike Brown')">Mike Brown</div>
          <div class="dropdown-item" (click)="selectAssignee('Emma Wilson')">Emma Wilson</div>
          <div class="dropdown-item" (click)="selectAssignee('Oliver Davis')">Oliver Davis</div>
        </div>
      }
    </div>

    <!-- Sort By -->
    <div class="filter-dropdown">
      <button class="dropdown-toggle" (click)="toggleDropdown('sort')">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6h18M3 12h12M3 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="dropdown-label">Sort:</span>
        <span class="dropdown-value">{{ selectedSort }}</span>
        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      @if (openDropdown === 'sort') {
        <div class="dropdown-menu">
          <div class="dropdown-item" (click)="selectSort('Priority (High to Low)')">Priority (High to Low)</div>
          <div class="dropdown-item" (click)="selectSort('Priority (Low to High)')">Priority (Low to High)</div>
          <div class="dropdown-item" (click)="selectSort('Recently Updated')">Recently Updated</div>
          <div class="dropdown-item" (click)="selectSort('Recently Created')">Recently Created</div>
          <div class="dropdown-item" (click)="selectSort('Issue Key (A-Z)')">Issue Key (A-Z)</div>
          <div class="dropdown-item" (click)="selectSort('Issue Key (Z-A)')">Issue Key (Z-A)</div>
          <div class="dropdown-item" (click)="selectSort('Story Points')">Story Points</div>
        </div>
      }
    </div>

    <!-- Clear All Filters -->
    @if (hasActiveFilters()) {
      <button class="clear-filters-btn" (click)="clearAllFilters()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Clear all
      </button>
    }
  </div>
  </div>
</div>
